import{P}from"./ProgramLayout-1d440752.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import{D as q,m as d,o as n,f as m,a as o,w as l,F as g,b as i,c as f,d as r,g as v,t as y,p as E}from"./app-d9f75028.js";import{F as j,W as V}from"./WarningOutlined-db278ef6.js";import"./judoka-logo-eef90ab5.js";import"./VideoCameraOutlined-6422ac09.js";const B={components:{DownloadOutlined:q,FileExcelOutlined:j,WarningOutlined:V,ProgramLayout:P},props:["competition","programs","teams"],data(){return{dateFormat:"YYYY-MM-DD",filter_programs:[],modal:{isOpen:!1,mode:null,title:"Record Modal",data:{}},columns:[{title:"Team",dataIndex:"team"},{title:"Name",dataIndex:"name_display"},{title:"Gender",dataIndex:"gender"},{title:"Program",dataIndex:"program"},{title:"Operation",dataIndex:"operation"}],genders:["M","F"],rules:{country:{required:!0},name:{required:!0},date_start:{required:!0},date_end:{required:!0}},validateMessages:{required:"${label} is required!",types:{email:"${label} is not a valid email!",number:"${label} is not a valid number!"},number:{range:"${label} must be between ${min} and ${max}"}},files:[],visible:!1,errors:[],imported:!1}},created(){this.filter_programs=this.programs},methods:{onCreateRecord(){this.modal.title="Create",this.modal.data={new_team:!1},this.modal.mode="CREATE",this.modal.isOpen=!0},onEditRecord(s){this.modal.title="Edit",this.modal.mode="EDIT",this.modal.data={...s,new_team:!1},this.modal.data.programs=this.modal.data.programs.map(a=>a.id),this.filter_programs=this.programs.filter(a=>a.weight_code.includes(s.gender)),console.log(s.gender),console.log(this.programs),this.modal.isOpen=!0},onUpdate(){this.$refs.formRef.validateFields().then(()=>{this.$inertia.put(route("manage.competition.athletes.update",{competition:this.competition.id,athlete:this.modal.data.id}),this.modal.data,{onSuccess:s=>{this.modal.data={},this.modal.isOpen=!1},onError:s=>{console.log(s)}}),console.log("values",this.modal.data,this.modal.data)}).catch(s=>{console.log("error",s)})},changeGender(s){console.log(s),this.filter_programs=this.programs.filter(a=>a.weight_code.includes(s))},onCreate(){this.$refs.formRef.validateFields().then(()=>{this.$inertia.post(route("manage.competition.athletes.store",this.competition.id),this.modal.data,{onSuccess:s=>{this.modal.data={},this.modal.isOpen=!1},onError:s=>{console.log(s)}}),console.log("values",this.modal.data,this.modal.data)}).catch(s=>{console.log(s)})},handleImport(){const s=new FormData;s.append("file",this.files[0].originFileObj),window.axios.post(route("manage.competition.athletes.import",this.$page.props.competition.id),s,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:a})=>{this.$message.success("Import Success"),this.files=[],this.errors=a.errors,this.imported=!0,this.$inertia.reload(),this.$emit("imported")}).catch(()=>{this.$message.error("Import Error")})},confirmLockAthlets(){Modal.confirm({title:"Do you want to lock list of athletes?",icon:createVNode(ExclamationCircleOutlined),style:"top:20vh",onOk:()=>{this.lockAthletes()},onCancel(){console.log("Cancel")},class:"test"})},lockAthletes(){this.$inertia.post(route("manage.competition.athletes.lock",this.competition.id),"",{onSuccess:s=>{console.log(s)},onError:s=>{console.log(s)}})},handleFileChange(s){this.imported=!1,this.errors=[]}}},G={class:"py-12 mx-8"},Y={class:"overflow-hidden flex flex-col gap-3"},W={class:"text-right"},z={key:1,class:"text-blue-500"},H={class:"grid grid-cols-4 gap-12 py-4"},J={class:"p-4 mb-2 shadow-lg bg-white rounded-lg"},K={class:"flex justify-between"},Q=i("div",{class:"text-xl font-bold pb-2"},"Athletes List",-1),X={class:"flex gap-3"},Z={class:"flex flex-col"},$={class:"flex justify-between gap-3"},ee={class:"w-1/2"},te={class:"w-1/2"},oe={class:"flex justify-between gap-3"},ae={class:"w-1/3"},le={class:"w-1/3"},se={class:"w-1/3"},ie={key:0,class:"flex gap-3"},ne={key:1,class:"flex gap-3"},de={class:"text-right"},re={class:"ant-upload-drag-icon"},me=i("p",{class:"ant-upload-text"},"Click or drag files here to import athletes",-1),pe=i("p",{class:"ant-upload-hint"}," Supports xlsx file upload. Please confirm that the data format is consistent with the template before uploading. ",-1),ce={key:0,class:"mt-3"},ue={key:0,class:"font-bold my-3 text-green-500"},_e={key:1,class:"font-bold my-3 text-yellow-500"},he={class:"flex w-full justify-between"},fe={href:"/templates/athlete_list.xlsx"};function ge(s,a,c,ve,t,_){const A=d("inertia-head"),D=d("a-page-header"),p=d("a-button"),b=d("a-statistic"),k=d("a-card"),L=d("a-table"),w=d("a-input"),h=d("a-form-item"),x=d("a-select"),F=d("a-form"),I=d("a-modal"),U=d("file-excel-outlined"),R=d("a-upload-dragger"),S=d("warning-outlined"),N=d("DownloadOutlined"),M=d("ProgramLayout");return n(),m(g,null,[o(A,{title:"Athletes List"}),o(M,{competitionId:c.competition.id},{default:l(()=>[o(D),i("div",G,[i("div",Y,[i("div",W,[c.competition.status===0?(n(),f(p,{key:0,type:"primary",class:"bg-blue-500",onClick:s.confirmLockAthletes},{default:l(()=>[r("Lock list")]),_:1},8,["onClick"])):(n(),m("span",z,"List already lock"))]),i("div",H,[o(k,{class:"shadow-lg"},{default:l(()=>[o(b,{title:"Status",value:"Ready to start"})]),_:1}),o(k,{class:"shadow-lg"},{default:l(()=>[o(b,{title:"Date",value:c.competition.date_start+" ~ "+c.competition.date_end},null,8,["value"])]),_:1}),o(k,{class:"shadow-lg"},{default:l(()=>[o(b,{title:"Programs",value:c.programs.length},null,8,["value"])]),_:1}),o(k,{class:"shadow-lg"},{default:l(()=>[o(b,{title:"Atheles",value:c.competition.athletes.length},null,8,["value"])]),_:1})]),i("div",J,[i("div",K,[Q,i("div",X,[c.competition.status===0?(n(),f(p,{key:0,type:"primary",class:"bg-blue-500",onClick:_.onCreateRecord},{default:l(()=>[r("Add Athletes ")]),_:1},8,["onClick"])):v("",!0),c.competition.status===0?(n(),f(p,{key:1,type:"primary",class:"bg-blue-500",onClick:a[0]||(a[0]=e=>t.visible=!0)},{default:l(()=>[r("Import Athletes")]),_:1})):v("",!0)])]),o(L,{dataSource:c.competition.athletes,columns:t.columns},{bodyCell:l(({column:e,record:u})=>{var O;return[e.dataIndex==="operation"?(n(),f(p,{key:0,onClick:C=>_.onEditRecord(u)},{default:l(()=>[r("Edit")]),_:2},1032,["onClick"])):e.dataIndex==="team"?(n(),m(g,{key:1},[r(y((O=u==null?void 0:u.team)==null?void 0:O.name),1)],64)):e.dataIndex==="program"?(n(!0),m(g,{key:2},E(u.programs,C=>(n(),m("span",{key:C.id},y(C.weight_code),1))),128)):(n(),m(g,{key:3},[r(y(u[e.dataIndex]),1)],64))]}),_:1},8,["dataSource","columns"])])])]),o(I,{open:t.modal.isOpen,"onUpdate:open":a[10]||(a[10]=e=>t.modal.isOpen=e),width:"1000px",footer:null,title:t.modal.title},{default:l(()=>[o(F,{name:"ModalForm",ref:"formRef",model:t.modal.data,layout:"vertical",autocomplete:"off",rules:t.rules,"validate-messages":t.validateMessages},{default:l(()=>[i("div",Z,[i("div",$,[i("div",ee,[o(h,{label:"Name",name:"name"},{default:l(()=>[o(w,{type:"input",value:t.modal.data.name,"onUpdate:value":a[1]||(a[1]=e=>t.modal.data.name=e)},null,8,["value"])]),_:1})]),i("div",te,[o(h,{label:"Name display",name:"name_display"},{default:l(()=>[o(w,{type:"input",value:t.modal.data.name_display,"onUpdate:value":a[2]||(a[2]=e=>t.modal.data.name_display=e)},null,8,["value"])]),_:1})])]),i("div",oe,[i("div",ae,[o(h,{label:"Gender",name:"gender"},{default:l(()=>[o(x,{onChange:_.changeGender,value:t.modal.data.gender,"onUpdate:value":a[3]||(a[3]=e=>t.modal.data.gender=e),options:t.genders.map(e=>({value:e}))},null,8,["onChange","value","options"])]),_:1})]),i("div",le,[o(h,{label:"Programs",name:"programs"},{default:l(()=>[o(x,{value:t.modal.data.programs,"onUpdate:value":a[4]||(a[4]=e=>t.modal.data.programs=e),mode:"multiple",disabled:t.modal.data.gender==null,options:t.filter_programs.map(e=>({label:e.weight_code,value:e.id}))},null,8,["value","disabled","options"])]),_:1})]),i("div",se,[o(h,{label:"Team",name:"team_id"},{default:l(()=>[t.modal.data.new_team==!1?(n(),m("div",ie,[o(x,{value:t.modal.data.team_id,"onUpdate:value":a[5]||(a[5]=e=>t.modal.data.team_id=e),options:c.teams.map(e=>({value:e.id,label:e.name}))},null,8,["value","options"]),o(p,{onClick:a[6]||(a[6]=e=>t.modal.data.new_team=!0)},{default:l(()=>[r("New team")]),_:1})])):(n(),m("div",ne,[o(w,{type:"input",value:t.modal.data.team,"onUpdate:value":a[7]||(a[7]=e=>t.modal.data.team=e)},null,8,["value"]),o(p,{onClick:a[8]||(a[8]=e=>t.modal.data.new_team=!1)},{default:l(()=>[r("Old team")]),_:1})]))]),_:1})])]),i("div",de,[o(h,null,{default:l(()=>[t.modal.mode=="CREATE"?(n(),f(p,{key:0,class:"bg-blue-500",type:"primary",onClick:_.onCreate},{default:l(()=>[r("Create")]),_:1},8,["onClick"])):v("",!0),t.modal.mode=="EDIT"?(n(),f(p,{key:1,class:"bg-blue-500",type:"primary",onClick:_.onUpdate},{default:l(()=>[r("Update")]),_:1},8,["onClick"])):v("",!0),o(p,{style:{"margin-left":"10px"},onClick:a[9]||(a[9]=e=>this.modal.isOpen=!1)},{default:l(()=>[r("Close")]),_:1})]),_:1})])])]),_:1},8,["model","rules","validate-messages"])]),_:1},8,["open","title"]),o(I,{title:"Import Athletes List",open:t.visible,"onUpdate:open":a[12]||(a[12]=e=>t.visible=e)},{footer:l(()=>[i("div",he,[i("a",fe,[o(p,{type:"link"},{icon:l(()=>[o(N)]),default:l(()=>[r(" Download Athletes list template ")]),_:1})]),o(p,{type:"primary",class:"bg-blue-500",onClick:_.handleImport,disabled:t.files.length===0},{default:l(()=>[r("Import")]),_:1},8,["onClick","disabled"])])]),default:l(()=>[o(R,{fileList:t.files,"onUpdate:fileList":a[11]||(a[11]=e=>t.files=e),name:"file",onChange:_.handleFileChange,beforeUpload:()=>!1,multiple:!1},{default:l(()=>[i("p",re,[o(U)]),me,pe]),_:1},8,["fileList","onChange"]),t.imported?(n(),m("div",ce,[t.errors.length===0?(n(),m("div",ue," Import Success! ")):(n(),m("div",_e," Some information are not import ")),(n(!0),m(g,null,E(t.errors,(e,u)=>(n(),m("p",{key:u,class:"font-mono m-0"},[o(S,{class:"!text-yellow-500"}),r(" row "+y(e.row)+", "+y(e.errors[0]),1)]))),128))])):v("",!0)]),_:1},8,["open"])]),_:1},8,["competitionId"])],64)}const Ie=T(B,[["render",ge]]);export{Ie as default};
