import{P as H}from"./ProgramLayout-1d440752.js";import{l as Q}from"./lodash-ddff52aa.js";import{_ as X}from"./_plugin-vue_export-helper-c27b6911.js";import{a as n,A as k,I as Y,k as K,l as $,m as u,o as i,c as g,w as s,d as m,g as p,f as _,b as c,F as O,p as ee,n as te,t as f,q as ae,s as re}from"./app-d9f75028.js";import"./judoka-logo-eef90ab5.js";import"./VideoCameraOutlined-6422ac09.js";var oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"};const se=oe;function N(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),r.forEach(function(o){ne(t,o,a[o])})}return t}function ne(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var C=function(e,a){var r=N({},e,a.attrs);return n(k,N({},r,{icon:se}),null)};C.displayName="PlayCircleOutlined";C.inheritAttrs=!1;const ie=C;var le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M705.6 124.9a8 8 0 00-11.6 7.2v64.2c0 5.5 2.9 10.6 7.5 13.6a352.2 352.2 0 0162.2 49.8c32.7 32.8 58.4 70.9 76.3 113.3a355 355 0 0127.9 138.7c0 48.1-9.4 94.8-27.9 138.7a355.92 355.92 0 01-76.3 113.3 353.06 353.06 0 01-113.2 76.4c-43.8 18.6-90.5 28-138.5 28s-94.7-9.4-138.5-28a353.06 353.06 0 01-113.2-76.4A355.92 355.92 0 01184 650.4a355 355 0 01-27.9-138.7c0-48.1 9.4-94.8 27.9-138.7 17.9-42.4 43.6-80.5 76.3-113.3 19-19 39.8-35.6 62.2-49.8 4.7-2.9 7.5-8.1 7.5-13.6V132c0-6-6.3-9.8-11.6-7.2C178.5 195.2 82 339.3 80 506.3 77.2 745.1 272.5 943.5 511.2 944c239 .5 432.8-193.3 432.8-432.4 0-169.2-97-315.7-238.4-386.7zM480 560h64c4.4 0 8-3.6 8-8V88c0-4.4-3.6-8-8-8h-64c-4.4 0-8 3.6-8 8v464c0 4.4 3.6 8 8 8z"}}]},name:"poweroff",theme:"outlined"};const ce=le;function U(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),r.forEach(function(o){de(t,o,a[o])})}return t}function de(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var I=function(e,a){var r=U({},e,a.attrs);return n(k,U({},r,{icon:ce}),null)};I.displayName="PoweroffOutlined";I.inheritAttrs=!1;const ue=I;var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"}}]},name:"undo",theme:"outlined"};const ge=me;function L(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},r=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),r.forEach(function(o){he(t,o,a[o])})}return t}function he(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var x=function(e,a){var r=L({},e,a.attrs);return n(k,L({},r,{icon:ge}),null)};x.displayName="UndoOutlined";x.inheritAttrs=!1;const _e=x,pe=/(M|F|MF)W((\d+)(\+|\-)|ULW|0)/i,D={M:"男子",F:"女子",MF:"混合"},j={M:"blue",F:"red",MF:"green"},E={"+":"以上","-":"以下",ULW:"無限量級",OPEN:"開放級",0:"新人組"},P=t=>{const e=pe.exec(t).filter(r=>r!==void 0);if(e.length<3)throw new Error("Invalid weight format");const a=()=>e.length===5?D[e[1]]+e[3]+"公斤"+E[e[4]]:D[e[1]]+E[e[2]];return{nameZh:a,gender:e[1],symbol:e[4]??null,weight:e[3]??e[2],color:j[e[1]],code:t,toObject:()=>({code:t,color:j[e[1]],gender:e[1],weight:e[2],nameZh:a()})}},fe={created:0,athletes_confirmed:1,program_arranged:2,seat_locked:3,program_started:4,finished:5};const ve={name:"DrawControl",components:{ProgramLayout:H,PoweroffOutlined:ue,InfoCircleOutlined:Y,FileTextOutlined:K,UndoOutlined:_e,PlayCircleOutlined:ie},props:{competition:{type:Object,required:!0},programs:{type:Array,required:!0}},setup(){const t=new BroadcastChannel("draw"),e=$(!1);return t.postMessage({message:"ping"}),t.onmessage=a=>{switch(console.debug(a),a.data.message){case"pong":e.value=!0;return;case"disconnect":e.value=!1;return}},{COMPETITION_STATUS:fe,isRunning:e,bc:t}},data(){return{activeGender:"M",activeCategoryId:null,activeProgramId:null,athletes:[],nowActive:"",showResult:!1}},computed:{programsByGender(){return t=>this.programs.filter(e=>P(e.weight_code).gender===t)},availableGenders(){return this.programs.reduce((t,e)=>(t.add(P(e.weight_code).gender),t),new Set)},availableCategories(){return Q.uniqBy(this.programsByGender(this.activeGender).map(t=>t.competition_category),"id")},programsByGenderCategory(){return this.programs.filter(t=>P(t.weight_code).gender===this.activeGender&&t.competition_category.id===this.activeCategoryId)},activeProgram(){return this.athletes=[],this.loadProgram(),this.programs.find(t=>t.id===this.activeProgramId)},genderTabList(){return[...this.availableGenders].map(t=>({tab:t,key:t}))},allProgramsDrew(){return this.programs.every(t=>t.status>0)},padAthleteList(){const t=[...this.athletes];if(this.activeProgram.status>0){console.log("activeProgram");const e={};t.sort((r,o)=>r.seat-o.seat).sort((r,o)=>(o.seat-r.seat>1&&(e[r.seat]=o.seat-r.seat),r.seat-o.seat)),Object.keys(e).forEach(r=>{r=parseInt(r);for(let o=1;o<e[r];o++)t.splice(r+o-1,0,{seat:r+o,athlete:null})});const a=this.activeProgram.chart_size-t.length;for(let r=0;r<a;r++)t.push({seat:t.length+1,athlete:null})}return t}},methods:{loadProgram(){this.activeProgramId&&window.axios.get(route("manage.competition.programs.show",[this.competition.id,this.activeProgramId])).then(({data:t})=>{console.log(t.program_athletes.sort((e,a)=>e.seat-a.seat).map(e=>e.athlete)),this.program=t.program,this.athletes=t.program_athletes.sort((e,a)=>e.seat-a.seat)})},draw(){return window.axios.post(route("manage.competition.program.draw",[this.competition.id,this.activeProgramId])).then(({data:t})=>{this.activeProgram.status=1,this.athletes=t.athletes})},closeDisplay(){this.bc.postMessage({message:"close"})},sendAction(t){switch(console.log("sending action",t),t){case"showCover":this.nowActive="showCover",this.bc.postMessage({message:"showCover"});break;case"showNameList":this.nowActive="showNameList",this.bc.postMessage({message:"showNameList",payload:JSON.stringify({athletes:this.athletes,program:this.activeProgram})});break;case"showGroupName":this.nowActive="showGroupName",this.bc.postMessage({message:"showGroupName",payload:JSON.stringify({program:this.activeProgram,athletes:this.athletes})});break;case"draw":this.nowActive="draw",this.handleDraw();break}},async handleDraw(){await this.draw(),this.bc.postMessage({message:"draw",payload:JSON.stringify({program:this.activeProgram,athletes:this.athletes,bouts:this.activeProgram.bouts})})},clearDraw(){},lockSeat(){this.$inertia.post(route("manage.competition.program.lock-seat",[this.competition.id]))}}},v=t=>(ae("data-v-01adfc17"),t=t(),re(),t),ye=v(()=>c("span",null,null,-1)),be={class:"fixed right-16 bottom-16 z-10"},we=["href"],Oe={class:"px-6"},Pe={class:"p-6 flex flex-col lg:flex-row gap-4"},ke={class:"w-full"},Ce=v(()=>c("a",{class:"hidden text-blue-500"},null,-1)),Ie={class:"flex"},xe={class:"shrink-0 w-2/3 flex items-center justify-center"},Se=v(()=>c("h3",{class:"text-lg text-slate-500 font-bold"},"尚未選擇組別",-1)),Te=v(()=>c("p",{class:"text-slate-500"},"請從左邊選擇一個組別",-1)),Ae={key:1},Me={class:"flex gap-3"},Ne={class:"rounded border px-4 py-2 overflow-clip relative flex"},Ue={key:0,class:"bg-yellow-500 absolute transform -rotate-45 w-12 h-6 -left-4 -top-4"},Le={class:"flex items-center text-xl mr-4"},De={key:1},je={key:0},Ee={key:2},Ge={key:0,class:"!fixed !bottom-16 w-full left-0 flex"},Be={class:"mx-auto shadow-lg !rounded-2xl bg-white dark:bg-neutral-900 p-1 px-6"},ze={class:"flex gap-2"},Fe={key:1,class:"p-6"},Ve=v(()=>c("h3",{class:"font-bold text-lg"},"no schedule",-1)),qe=v(()=>c("p",null,"no schedule hint",-1));function Re(t,e,a,r,o,l){const h=u("a-button"),b=u("a-tag"),G=u("a-page-header"),S=u("PoweroffOutlined"),T=u("a-alert"),B=u("a-list-item"),A=u("a-list"),z=u("a-tab-pane"),F=u("a-tabs"),w=u("a-card"),M=u("a-empty"),V=u("InfoCircleOutlined"),q=u("FileTextOutlined"),R=u("PlayCircleOutlined"),Z=u("UndoOutlined"),J=u("inertia-link"),W=u("ProgramLayout");return i(),g(W,{competitionId:a.competition.id},{default:s(()=>[n(G,{title:"Draw"},{extra:s(()=>[a.competition.status>r.COMPETITION_STATUS.seat_locked?(i(),g(h,{key:0,type:"link"},{default:s(()=>[m(" lock ")]),_:1})):p("",!0),a.competition.status===r.COMPETITION_STATUS.program_arranged&&l.allProgramsDrew?(i(),g(h,{key:1,type:"primary",class:"bg-blue-500",onClick:l.lockSeat},{default:s(()=>[m(" 鎖定抽籤 ")]),_:1},8,["onClick"])):p("",!0),ye]),tags:s(()=>[l.allProgramsDrew?(i(),g(b,{key:0,color:"success"},{default:s(()=>[m(" 所有組別完成抽籤 ")]),_:1})):p("",!0)]),_:1}),a.competition.status>=r.COMPETITION_STATUS.program_arranged?(i(),_(O,{key:0},[c("div",be,[r.isRunning?(i(),g(h,{key:1,type:"primary",danger:"",shape:"round",size:"large",class:"!shadow-lg",onClick:l.closeDisplay},{icon:s(()=>[n(S)]),default:s(()=>[m(" close draw screen ")]),_:1},8,["onClick"])):(i(),_("a",{key:0,href:t.route("manage.competition.athletes.draw-screen",a.competition.id),target:"_blank"},[n(h,{type:"primary",shape:"round",size:"large",class:"!shadow-lg bg-blue-500"},{icon:s(()=>[n(S)]),default:s(()=>[m(" draw screen ")]),_:1})],8,we))]),c("div",Oe,[l.allProgramsDrew&&a.competition.status===r.COMPETITION_STATUS.program_arranged?(i(),g(T,{key:0,type:"info","show-icon":"",message:"所有組別完成抽籤",description:"如果抽籤結果沒有問題請鎖定抽籤"})):p("",!0),a.competition.status>r.COMPETITION_STATUS.seat_locked?(i(),g(T,{key:1,type:"success","show-icon":"",message:"抽籤順序已經鎖定",description:"抽籤順序已經鎖定"})):p("",!0)]),c("div",Pe,[c("div",ke,[n(w,{"active-tab-key":o.activeGender,"tab-list":l.genderTabList,onTabChange:e[1]||(e[1]=d=>o.activeGender=d)},{default:s(()=>[Ce,n(F,{"active-key":o.activeCategoryId,"onUpdate:activeKey":e[0]||(e[0]=d=>o.activeCategoryId=d),"tab-position":"left"},{default:s(()=>[(i(!0),_(O,null,ee(l.availableCategories,d=>(i(),g(z,{tab:d.name,key:d.id},{default:s(()=>[n(A,{"data-source":l.programsByGenderCategory},{renderItem:s(({item:y})=>[n(B,{class:te(["p-4",{"!text-blue-500":o.activeProgramId===y.id}]),onClick:Ze=>o.activeProgramId=y.id,"data-status":y.status},{default:s(()=>[c("div",Ie,[y.status>0?(i(),g(b,{key:0,color:"success"},{default:s(()=>[m("已抽籤")]),_:1})):(i(),g(b,{key:1,color:"processing"},{default:s(()=>[m("待抽籤")]),_:1})),m(" "+f(y.weight_code),1)])]),_:2},1032,["class","onClick","data-status"])]),_:1},8,["data-source"])]),_:2},1032,["tab"]))),128))]),_:1},8,["active-key"])]),_:1},8,["active-tab-key","tab-list"])]),c("div",xe,[o.activeProgramId?(i(),_("div",Ae,[n(w,null,{title:s(()=>[m(f(l.activeProgram.name)+" 共"+f(o.athletes.length)+"人 ",1)]),extra:s(()=>[c("div",Me,[a.competition.status<r.COMPETITION_STATUS.seat_locked?(i(),_(O,{key:0},[l.activeProgram.status>0?(i(),g(h,{key:0,type:"link",danger:"",onClick:l.draw},{default:s(()=>[m(" 重新抽籤 ")]),_:1},8,["onClick"])):(i(),g(h,{key:1,type:"primary",class:"bg-blue-500",onClick:l.draw},{default:s(()=>[m(" 抽籤 ")]),_:1},8,["onClick"]))],64)):p("",!0)])]),default:s(()=>[n(A,{loading:o.athletes.length===0,"data-source":l.padAthleteList,class:"athlete-list"},{renderItem:s(({item:d})=>[c("div",Ne,[d.seed?(i(),_("div",Ue)):p("",!0),c("div",Le,f(d.seat),1),d.athlete?(i(),_("div",De,[c("div",null,f(d.athlete.name),1),c("div",null,f(d.athlete.team.abbreviation),1),a.competition.is_language_secondary_enabled?(i(),_("div",je,f(d.name_secondary),1)):p("",!0)])):(i(),_("div",Ee,"輪空"))])]),_:1},8,["loading","data-source"])]),_:1})])):(i(),g(M,{key:0},{description:s(()=>[Se,Te]),_:1}))])]),r.isRunning?(i(),_("div",Ge,[c("div",Be,[c("div",ze,[n(h,{type:"link",class:"control-button",onClick:e[2]||(e[2]=d=>l.sendAction("showGroupName")),disabled:!l.activeProgram},{icon:s(()=>[n(V)]),default:s(()=>[m(" 組別資訊 ")]),_:1},8,["disabled"]),n(h,{type:"link",class:"control-button",onClick:e[3]||(e[3]=d=>l.sendAction("showNameList")),disabled:!l.activeProgram},{icon:s(()=>[n(q)]),default:s(()=>[m(" 顯示名單 ")]),_:1},8,["disabled"]),n(h,{type:"link",class:"control-button",onClick:e[4]||(e[4]=d=>l.sendAction("draw")),disabled:!l.activeProgram||o.nowActive!=="showNameList"},{icon:s(()=>[n(R)]),default:s(()=>[m(" 開始抽籤 ")]),_:1},8,["disabled"]),n(h,{type:"link",class:"control-button",onClick:e[5]||(e[5]=d=>l.sendAction("showCover")),disabled:!l.activeProgram},{icon:s(()=>[n(Z)]),default:s(()=>[m(" 顯示封面 ")]),_:1},8,["disabled"])])])])):p("",!0)],64)):(i(),_("div",Fe,[n(w,null,{default:s(()=>[n(M,null,{description:s(()=>[Ve,qe,n(J,{href:t.route("manage.competition.programs.index",a.competition.id)},{default:s(()=>[n(h,{type:"primary",class:"bg-blue-500"},{default:s(()=>[m(" no schedule action ")]),_:1})]),_:1},8,["href"])]),_:1})]),_:1})]))]),_:1},8,["competitionId"])}const Ke=X(ve,[["render",Re],["__scopeId","data-v-01adfc17"]]);export{Ke as default};
